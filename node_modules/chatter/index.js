var all_sockets = null;

var userController = require('../../app/controllers/userexpense.controller')

exports.set_sockets = function(sockets) {
    all_sockets = sockets;
};

exports.connect_chatter = function(config) {

    config.socket.emit('entrance', {
        message: 'Welcome to the IRC Expense!'
    });

    config.socket.on('join', function(data) {
        config.socket.emit('join', {
            username: 'Welcome ' + data.username
        });
    });

    config.socket.on('chart', function(data) {
        userController.GetAllRecords(function(err, res) {
            if (!err) {
                switch (data) {
                    case 'pie':
                        all_sockets.sockets[config.socketId].emit('chart', {
                            records: res,
                            type: 'pie'
                        });
                        break;
                    case 'bar':
                        all_sockets.sockets[config.socketId].emit('chart', {
                            records: res,
                            type: 'bar'
                        });
                        break;
                }
            }
        });
    });

    config.socket.on('chat', function(data) {
        console.log(data);
        if (data != null) {
            userController.CreateRecord(data, function(err, res) {
                if (!err) {
                    all_sockets.sockets[config.socketId].emit('chat', {
                        message: 'recorded successfully',
                        statuscode: 200
                    });
                }
            });
        }
    });
};
